# 📡 server_info.py

서버의 디스크, CPU, 메모리 등의 자원 상태를 SSH를 통해 원격 수집하고, 콘솔에 시각적으로 출력해주는 도구입니다. `~/.ssh/config`에 정의된 서버들을 대상으로 병렬 수집을 수행합니다.

---

## ✅ 주요 기능

- `~/.ssh/config`의 서버 목록을 기반으로 SSH 접속
- 각 서버의 다음 정보 수집:
  - 디스크 사용량 (`/`, `/app`, `/data`)
  - CPU 코어 수 및 사용률
  - 전체 메모리 및 사용률
  - 내부 IP 주소
- 병렬 처리로 빠르게 조회 (기본 max 30개 동시 처리)
- rich.Table 기반 컬러 출력
- 로그는 `logs/app.log`에 저장되고 콘솔은 경고 이상만 표시됨

---

## 📦 설치 및 환경 설정

### 1. 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. 환경변수 설정 (.env)
```dotenv
SSH_CONFIG_FILE=~/.ssh/config
SSH_TIMEOUT=3
MAX_WORKER=30
```

---

## 🚀 실행 방법
```bash
python server_info.py
```

---

## 📂 출력 예시

```text
┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┓
┃ Server Name  ┃ Access IP   ┃ Internal IP ┃ / Tot┃ / % ┃ /app T┃/app %┃/data T┃/data %┃vCPU  ┃CPU % ┃Memory ┃Mem % ┃
┣━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━┫
┃ web01        ┃ 10.0.1.1    ┃ 172.16.1.10 ┃ 30G  ┃[green]25%[/green]┃ 10G   ┃[yellow]65%[/yellow]┃ 50G   ┃[red]90%[/red] ┃ 4    ┃[green]20%[/green] ┃8Gi    ┃[yellow]65.0%[/yellow]┃
┗━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━┻━━━━━━┻━━━━━━┻━━━━━━━┻━━━━━━┻━━━━━━━┻━━━━━━┻━━━━━━┻━━━━━━━┻━━━━━━━┻━━━━━━┛
```

- **컬러 기준**:
  - ✅ **녹색**: 여유 충분 (<60%)
  - ⚠️ **노란색**: 경고 (60~85%)
  - 🔥 **빨간색**: 위험 (85% 이상)

---

## 🧰 로그 경로 및 출력 형식

- 콘솔 로그: CRITICAL 이상만 출력
- 파일 로그: `logs/app.log`에 INFO 이상 전체 기록

로그 형식:
```
2025-03-26 14:32:10 | INFO | server_info.py:87 | SSH 연결 성공: 10.0.1.1
```

---

## 📁 파일 구조 예시
```
.
├── server_info.py
├── .env
├── logs/
│   └── app.log
├── requirements.txt
└── README.md
```

---

## 📝 참고 사항

- `~/.ssh/config`에 정의된 서버만 대상으로 동작합니다.
- 비밀번호 기반 SSH는 지원하지 않으며, **key 기반 인증만 지원**합니다.
- 접속 실패 시 각 서버는 "Connection Fail"로 표시되며, 실패 목록이 하단에 따로 출력됩니다.

---

## 🙋 사용 예시 `.ssh/config`
```ssh
Host web01
    Hostname 10.0.1.1
    User ubuntu
    IdentityFile ~/.ssh/mykey.pem
    Port 22
```

---

## 👨‍💻 유지보수자 정보
- 작성자: sykim
- 이메일 : cruiser594@gmail.com

---

## ✅ 향후 개선 아이디어
- HTML 리포트 자동 생성
- Slack으로 요약 알림 보내기
- 디스크 사용률 임계값에 따른 Alert
